<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Runner Game Test</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas { background: #30dcff; display: block; margin: 0 auto; }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="900" height="600"></canvas>

    <script>
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      var tileSize = 50;
      var leftTile = 0;
      var maxLeftTile = 40 - (900/tileSize);

      var rightPressed = false;
      var leftPressed = false;
      var upPressed = false;
      var downPressed = false;
      var spacePressed = false;
      var jumping = false;

      var map = [
        [2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
        [2,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,2],
        [2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2],
        [2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2]
      ]; // this is 40 x 12


      var dude = new Image();
      dude.src = './dude.png';
      var dudeHeight = 100;
      var dudeWidth = 90;
      var floatHeight = tileSize * 2;
      var jumpHeight = floatHeight;
      var jumpSpeed = 10;
      var walkSpeed = 20;
      var dudeX = (canvas.width - dudeWidth)/2;
      var dudeY = (canvas.height - dudeHeight - floatHeight);

      function draw() {
        var rowNum = -1;

        directionHandler();

        map.forEach((row) => {
          rowNum += 1;
          var tileNum = -1;
          row.forEach((tile) => {
            tileNum += 1;
            if (tile === 0) {
              ctx.fillStyle = "#30dcff";
            } else if (tile === 1){
              ctx.fillStyle = "green";
            } else if (tile === 2){
              ctx.fillStyle = "black";
            } else if (tile === 3){
              ctx.fillStyle = "brown";
            }
            if (tileNum >= leftTile) {
              ctx.fillRect((tileNum*tileSize - leftTile*tileSize), rowNum * tileSize, tileSize, tileSize);
            }
          })
        })
        jumpHandler();
        ctx.drawImage(dude, dudeX, dudeY);
      }

      function jumpHandler() {
        if(spacePressed && dudeY >= canvas.height-dudeHeight-floatHeight) {
          jumping = true;
        }

        if(jumping && dudeY > canvas.height-dudeHeight-floatHeight-jumpHeight) {
          dudeY -= jumpSpeed;
        } else if (jumping && dudeY <= canvas.height-dudeHeight-floatHeight-jumpHeight) {
          jumping = false;
          dudeY += jumpSpeed;
        }

        if(!jumping && dudeY < canvas.height-dudeHeight-floatHeight) {
          dudeY += jumpSpeed;
        }

        if(dudeY > canvas.height-dudeHeight-floatHeight) {
          dudeY = canvas.height-dudeHeight-floatHeight;
        }
      }

      function directionHandler() {
        if (leftPressed && leftTile > 0) {
          leftTile -= 1;
        } else if (leftPressed) {
          dudeX -= walkSpeed;
        }

        if (rightPressed && leftTile < maxLeftTile) {
          leftTile += 1;
        } else if (rightPressed) {
          dudeX += walkSpeed;
        }

        if (leftTile < 0) {
          leftTile = 0;
        } else if (leftTile > maxLeftTile) {
          leftTile = maxLeftTile;
        }

        if (dudeX < tileSize) {
          dudeX = tileSize;
        } else if (dudeX > canvas.width - dudeWidth - tileSize) {
          dudeX = canvas.width - dudeWidth - tileSize
        }
      }

      function keyDownHandler(e) {
        if(e.keyCode == 39) {
          rightPressed = true;
        }
        else if(e.keyCode == 37) {
          leftPressed = true;
        }
        else if(e.keyCode == 38) {
          upPressed = true;
        }
        else if(e.keyCode == 40) {
          downPressed = true;
        }
        else if(e.keyCode == 32) {
          spacePressed = true;
        }
      }

      function keyUpHandler(e) {
        if(e.keyCode == 39) {
          rightPressed = false;
        }
        else if(e.keyCode == 37) {
          leftPressed = false;
        }
        else if(e.keyCode == 38) {
          upPressed = false;
        }
        else if(e.keyCode == 40) {
          downPressed = false;
        }
        else if(e.keyCode == 32) {
          spacePressed = false;
        }
      }

      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);
      setInterval(draw, 25);
    </script>
  </body>
</html>
