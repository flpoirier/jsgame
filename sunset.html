<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sunset</title>
    <style>
      * { padding: 0; margin: 0; }
      canvas { display: block; margin: 0 auto; }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="1100" height="750"></canvas>
    <script>
      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      var canvasWidth = 1100;
      var canvasHeight = 750;

      var sunRad = 20;
      var sunX = canvasWidth / 2;
      var sunY = sunRad;
      var sunset = 0;

      var gameOver = false;

      function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min)) + min;
      }

      function distance(x1, y1, x2, y2) {
        return Math.sqrt( (x1-x2)*(x1-x2) + (y1-y2)*(y1-y2) );
      }

      var stars = [];
      var twinkle = 0;
      var falling = 0;
      for (let star = 0; star < 800; star++) {
        let starX = getRandomInt(0, canvasWidth);
        let starY = getRandomInt(-canvasHeight, 2 * canvasHeight / 3);
        let starRad = getRandomInt(1,3);
        let starSpeed = getRandomInt(4,15);
        stars.push([starX, starY, starRad, starSpeed]);
      }

      var red = 85;
      var green = 200;
      var blue = 255;

      function skyColored(r, g) {
        let redDiff = Math.abs(red - r);
        let greenDiff = Math.abs(green - g);
        if (redDiff === 0 && greenDiff === 0) {
          return true;
        } else {
          return false;
        }
      }

      function draw() {

        sunset += 1;

        if (sunset === 5 && blue > 40) {
          red -= 1;
          green -= 2;
          blue -= 2;
          sunset = 0;
        }

        if (sunY < (800)) {
          sunY += 1;
        } else {
          gameOver = true;
        }

        ctx.fillStyle = `rgb(${red},${green},${blue})`;
        ctx.fillRect(0,0,canvasWidth,canvasHeight);
        //
        // ctx.fillStyle = "rgb(6,76,6)";
        // ctx.fillRect(0,400,900,200);

        // for (let x = (sunX - 150); x < (sunX + 150); x++) {
        //   for (let y = (sunY - 150); y < (sunY + 150); y++) {
        //     dist = Math.ceil(distance(sunX, sunY, x, y));
        //     ctx.fillStyle = `rgb(${red - dist + 150},${green},${blue})`;
        //     ctx.fillRect(x,y,1,1)
        //   }
        // }

        // for (let dist = 300; dist >= 0; dist--) {

        // ctx.fillStyle = "purple";
        // ctx.beginPath();
        // ctx.arc(sunX, sunY, 502, 0, 2 * Math.PI);
        // ctx.fill();
        if (blue < 150) {

          twinkle += 1;

          if (twinkle === 20 && !gameOver) {
            // for (let num = 0; num < 2; num++) {
              let idx = getRandomInt(0,stars.length);
              if (stars[idx][2] === 0) {
                stars[idx][2] = 1;
              } else if (stars[idx][2] === 1) {
                stars[idx][2] = getRandomInt(0,3);
              } else if (stars[idx][2] === 2) {
                stars[idx][2] = 1;
              }
            // }
            twinkle = 0;
          }

          stars.forEach((star) => {
            // let stardist = distance(star[0],star[1],sunX, sunY);
            // ctx.fillStyle = `rgba(255,255,255,${stardist/1000})`;
            ctx.fillStyle = "white";
            ctx.beginPath();
            ctx.arc(star[0], star[1], star[2], 0, 2 * Math.PI);
            ctx.fill();
          });
        }

        let dist = 450;
        let tempRed = 255;
        let tempGreen = 255;

        while (dist >= 0) {

          tempRed = red - dist + Math.floor(300*sunY/500);
          if (tempRed < red) {
            tempRed = red;
          }
          tempGreen = green - dist + Math.floor(175*sunY/500);
          if (tempGreen < green) {
            tempGreen = green;
          }
          // let tempBlue = blue + dist + Math.floor(200*sunY/500);
          // if (tempBlue < blue) {
          //   tempBlue = blue;
          // }
          if (!skyColored(tempRed, tempGreen)) {
            ctx.fillStyle = `rgb(${tempRed},${tempGreen},${blue})`;
            ctx.beginPath();
            ctx.arc(sunX, sunY, dist, 0, 2 * Math.PI);
            ctx.fill();
          }

          dist -= 3;
        }

        ctx.fillStyle = "white";
        ctx.beginPath();
        ctx.arc(sunX, sunY, sunRad, 0, 2 * Math.PI);
        ctx.fill();

        if (gameOver && twinkle > 500) {
          // stars[falling][1] += 15;
          // if (stars[falling][1] > canvasHeight + 5) {
          //   falling += 1;
          // }
          stars.forEach((star) => {
            star[1] += star[3];
          });
        }

        ctx.strokeStyle = "#7b9095";
        ctx.lineWidth = 15;
        ctx.beginPath();
        ctx.arc(canvasWidth / 2, canvasHeight + 400, canvasWidth * 2/3, Math.PI, 2 * Math.PI)
        ctx.stroke();
      }

      setInterval(draw, 10);

    </script>
  </body>
</html>
